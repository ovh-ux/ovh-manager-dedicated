<div data-ng-controller="ServerConsumptionCtrl as ctrl">

    <div class="oui-tile">
        <h4 class="oui-header_4 oui-tile__title">
            <span data-i18n-static="server_consumption_label"></span>
            <span class="oui-icon oui-icon-help_circle oui-tooltip__trigger"
                  oui-tooltip="{{:: tr('server_consumption_explanation') }}"></span>
        </h4>
        <div class="oui-tile__body text-center"
             data-ng-if="ctrl.server.loading || ctrl.traffic.loading">
            <oui-spinner></oui-spinner>
        </div>
        <div class="oui-tile__body"
             data-ng-if="!ctrl.server.loading && !ctrl.traffic.loading">
            <div class="oui-tile__item"
                 data-ng-if="ctrl.traffic.data.usage.resetQuotaTimeLeft && ctrl.traffic.data.usage.isThrottled">
                <span class="text-danger"
                      data-ng-if="ctrl.traffic.data.usage.resetQuotaTimeLeft"
                      data-ng-bind="tr('server_consumption_summary_' + ctrl.traffic.data.usage.resetQuotaTimeLeft.unit, [
                        ctrl.traffic.data.usage.remainingOutputQuotaSize.text,
                        ctrl.traffic.data.usage.resetQuotaTimeLeft.value
                      ])"
                      data-ng-class="{ 'danger': state.overQuota }">
                </span>
                <span class="text-danger"
                      data-ng-if="ctrl.traffic.data.usage.isThrottled"
                      data-ng-class="{ 'danger': ctrl.traffic.data.usage.overQuota }">
                    <span> - </span>
                    <span data-i18n-static="server_consumption_throttled"></span>
                </span>
            </div>
            <div class="oui-tile__item">
                <dl class="oui-tile__definition">
                    <dt class="oui-tile__term"
                        data-ng-bind="tr('server_consumption_current_period_label', [ctrl.traffic.data.usage.outputQuotaSize.text])"></dt>
                    <dd class="oui-tile__description"
                        data-ng-if="ctrl.traffic.data.usage.outputQuotaUsed.value">
                        <div class="oui-progress oui-progress_info"
                             data-ng-class="{
                                'oui-progress_warning': ctrl.traffic.data.usage.nearQuota,
                                'oui-progress_error': ctrl.traffic.data.usage.overQuota
                            }">
                            <div class="oui-progress__bar"
                                 role="progressbar"
                                 aria-valuemin="0"
                                 aria-valuemax="{{ ctrl.traffic.data.usage.outputQuotaSize.value }}"
                                 aria-valuenow="{{ ctrl.traffic.data.usage.outputQuotaUsed.value }}"
                                 data-ng-style="{ 'width': ctrl.traffic.data.usage.remainingOutputQuotaSize.percent + '%' }"
                                 data-ng-class="{
                                    'oui-progress__bar_warning': ctrl.traffic.data.usage.nearQuota,
                                    'oui-progress__bar_error': ctrl.traffic.data.usage.overQuota
                                 }">
                                <span class="oui-progress__label"
                                      data-ng-bind-template="{{ ctrl.traffic.data.usage.outputQuotaUsed.text }}"></span>
                            </div>
                        </div>
                        <span data-ng-bind="tr('server_consumption_current_period_remaining', [ctrl.traffic.data.usage.remainingOutputQuotaSize.text])"></span>
                    </dd>
                </dl>
                <div class="oui-tile__actions"
                     data-ng-if="ctrl.canOrderTraffic() && ctrl.canOrderMoreTraffic()">
                    <oui-action-menu
                        aria-label="{{:: tr('menu_action_label', tr('server_consumption_current_period_label')) }}"
                        data-align="end"
                        data-compact>
                        <oui-action-menu-item
                            data-text="{{ tr(ctrl.trafficOption.data !== 'subscribed' ? 'server_traffic_order_button' : 'server_traffic_change_button') }}"
                            data-aria-label="{{:: tr('server_traffic_order_button') }}"
                            data-on-click="setAction('traffic/order/dedicated-server-traffic-order', ctrl.server.data.name)"
                            data-disabled="ctrl.server.data.state === 'HACKED' || ctrl.server.data.state === 'HACKED_BLOCKED'"></oui-action-menu-item>
                    </oui-action-menu>
                </div>
            </div>
        </div>
    </div>
</div>
