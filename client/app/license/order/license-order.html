<header class="page-header" role="banner">
    <h1 data-i18n-static="license_order_title"></h1>
</header>

<div class="text-center"
     data-ng-show="loaders.ips">
    <oui-spinner></oui-spinner>
</div>

<div class="tab-content"
     data-ng-show="loaders.ips == false">

    <div data-ovh-alert="{{ alerts.order }}"></div>

    <a class="d-inline-block mb-5"
       title="{{ i18n.license_details_back }}"
       data-ng-href="#/configuration/license" >
       <span class="fa fa-chevron-left mr-2"
             aria-hidden="true">
       </span>
       <span data-i18n-static="license_details_back"></span>
    </a>

    <div class="alert alert-warning"
         data-ng-if="availableIpBlock.ips.length === 0"
         role="alert"
         data-i18n-static="license_order_no_license_available">
    </div>

    <div class="row d-md-flex"
         data-ng-if="availableIpBlock.ips.length > 0">
        <div class="col-md-10 col-lg-6 mx-md-auto">

            <!-- step 1 -->
            <h2 data-i18n-static="license_order_step1_title"></h2>

            <div class="form-group">
                <label for="selectedIpBlock"
                       class="control-label"
                       data-i18n-static="license_order_step1_ip_block">
                </label>
                <div class="input-group">
                    <select class="form-control"
                            id="selectedIpBlock"
                            name="selectedIpBlock"
                            data-ng-options="ip as getBlockDisplay(ip) group by ip.serviceName for ip in availableIpBlock.ips | filter:filters.block.type | filter:filters.block.search"
                            data-ng-model="selected.ipBlock">
                        <option value=""
                                data-i18n-static="license_order_step1_ip_block_none">
                        </option>
                    </select>
                    <span class="input-group-addon"
                          id="licenseOrderBlockFilters"
                          data-tooltip-box
                          data-tb-unique="true"
                          data-tb-content-template="license/tooltips/blockFilterTooltip.html"
                          data-tb-hide-on-blur="false"
                          data-tb-placement="bottom">
                        <i class="fa fa-search" aria-hidden="true"></i>
                    </span>
                </div>

            </div>

            <div class="form-group"
                 data-ng-class="{
                    'has-error': !ipValid.value
                 }">
                <label for="targetIp"
                       class="control-label"
                       data-i18n-static="license_order_step1_ip">
                </label>
                <input type="text"
                       class="form-control"
                       id="targetIp"
                       name="targetIp"
                       data-ng-show="!oneIp"
                       data-ng-model="selected.ip"
                       data-ng-change="ipIsValid();"
                       data-ng-disabled="selected.ipBlock === null" />
                <p class="form-control-static"
                   data-ng-show="oneIp"
                   data-ng-bind="selected.ip">
                </p>
            </div>

            <div class="text-center"
                 data-ng-show="selected.ipBlock && loaders.orderableVersion == true">
                <oui-spinner></oui-spinner>
            </div>

            <div class="form-group"
                 data-ng-show="selected.ip != null && ipValid.value">
                <img class="oui-box oui-box_light mx-2 mb-2"
                     alt="{{ type }}"
                     width="120"
                     data-ng-repeat="type in availableTypes"
                     data-ng-src="images/license/{{ type }}_medium.png"
                     data-ng-click="selectType(type)"
                     data-ng-style="!isAvailable(type) || loaders.orderableVersion == true ? {
                        filter: 'grayscale(100%)',
                        cursor: 'not-allowed'
                     } : ''"
                     data-ng-class="{
                         'disabled': !isAvailable(type) || loaders.orderableVersion == true,
                         'selected': selected.licenseType == type,
                         'opa3': selected.licenseType && selected.licenseType != type
                     }" />
                <p class="text-danger text-center"
                   data-ng-show="nbLicence.value == 0 && loaders.orderableVersion != true"
                   data-ng-bind="tr('license_order_step1_no_license_available', [selected.ip])">
                </p>
            </div>

            <!-- step 2-->
            <div data-ng-show="selected.licenseType">
                <h2 data-i18n-static="license_order_step2_title"></h2>

                <div class="form-group">
                    <label for="optionVersion"
                           class="control-label">
                        <span data-i18n-static="license_order_step2_version"></span>
                        <span class="text-danger"> *</span>
                    </label>
                    <select class="form-control"
                            id="optionVersion"
                            name="optionVersion"
                            data-ng-options="optionVersion as (i18n['license_designation_' + selected.licenseType + '_version_' + optionVersion.value] || optionVersion.value) for optionVersion in types[selected.licenseType].options[0].options"
                            data-ng-model="selected.version">
                        <option value=""
                                data-ng-disabled="true"
                                data-i18n-static="license_order_common_choose">
                        </option>
                    </select>
                </div>

                <div data-ng-show="hasMoreOptions()"
                     data-ng-include="selected.licenseType && 'license/order/options/' + selected.licenseType + '.html' || ''">
                </div>

                <div class="alert alert-warning"
                     role="alert"
                     data-ng-if="selected.version.potentialProblems.length > 0">
                    <p data-i18n-static="license_potential_problem"></p>
                    <ul>
                        <li data-ng-repeat="problem in selected.version.potentialProblems track by $index">
                            <span>{{ i18n['license_potential_problem_' + problem] }}</span>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="text-center"
                 data-ng-show="loaders.durations">
                <oui-spinner></oui-spinner>
                <span data-i18n-static="license_loading"></span>
            </div>

            <!-- step 3-->
            <div data-ng-show="isSelectionValid()">
                <h2 data-i18n-static="license_order_step3_title"></h2>

                <div class="radio"
                     data-ng-hide="loaders.durations"
                     data-ng-repeat="duration in durations.available">
                    <label>
                        <input type="radio"
                               value="{{ duration }}"
                               data-ng-model="selected.duration"
                               data-ng-change="selectDuration()"
                               data-ng-disabled="loaders.prices || durations.available.length == 1" />
                        {{ duration | duration:'longDate' }}&nbsp;:&nbsp;<span data-ng-bind-html="durations.details[duration].prices | price:user.ovhSubsidiary"></span>
                        <oui-spinner data-ng-hide="durations.details[duration]"
                                    data-size="s"
                                    data-inline="true">
                        </oui-spinner>
                    </label>
                </div>

                <div class="text-center"
                     data-ng-show="loaders.durations">
                    <oui-spinner></oui-spinner>
                    <span data-i18n-static="license_loading"></span>
                </div>
            </div>

            <!-- Step 4: Contracts and validation -->
            <div data-ng-show="selected.duration">
                <h2 data-i18n-static="license_order_step4_title"></h2>

                <div class="row"
                     data-ng-hide="order.url">
                    <div class="col-md-9">
                        <strong class="text-primary"
                                data-ng-if="!agoraEnabled && durations.details[selected.duration].contracts.length == 0"
                                data-i18n-static="license_order_step4_question">
                        </strong>
                        <strong class="text-primary"
                                data-ng-if="agoraEnabled && durations.details[selected.duration].contracts.length == 0"
                                data-i18n-static="license_order_step4_clic_here">
                        </strong>

                        <div data-ng-if="!agoraEnabled"
                             data-ng-show="durations.details[selected.duration].contracts.length > 0">
                            <strong class="text-primary"
                                    data-ng-if="!agoraEnabled"
                                    data-i18n-static="license_order_step4_contracts_ask">
                            </strong>
                            <strong class="text-primary"
                                    data-ng-if="agoraEnabled"
                                    data-i18n-static="license_order_step4_contracts_agora_ask">
                            </strong>
                            <table class="table table-hover">
                                <tbody>
                                    <tr data-ng-repeat="contract in durations.details[selected.duration].contracts">
                                        <td>
                                            <a target="_blank"
                                               rel="noopener"
                                               data-ng-href="{{ contract.url }}"
                                               data-ng-bind="contract.url">
                                            </a>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <div class="checkbox">
                                <label>
                                    <input type="checkbox"
                                           data-ng-model="contractsValidated.value" />
                                    <span data-i18n-static="license_order_step4_contracts_check"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-3"
                         data-ng-if="!agoraEnabled">
                        <button type="button"
                                class="btn btn-primary"
                                data-ng-hide="loaders.bc"
                                data-ng-click="generateBc()">
                            <i class="icon-order-licence" aria-hidden="true"></i>
                            {{ i18n.license_order_step4_generate }}
                        </button>
                        <span data-ng-show="loaders.bc"
                              data-i18n-static="license_order_step4_generating">
                        </span>
                        <img class="ajax-loader"
                             alt=""
                             data-ng-show="loaders.bc"
                             data-ng-src="images/license/ajax-loader.gif" />
                    </div>
                    <div class="col-md-3"
                         data-ng-if="agoraEnabled">
                        <a href="{{ selected.agoraUrl }}"
                           class="btn btn-primary"
                           target="_blank"
                           data-ng-if="selected.agoraUrl"
                           data-ng-hide="loaders.bc">
                            <i class="icon-order-licence" style="margin-top: 5px !important"></i>
                            {{ i18n.license_order_step4_pay_button }}
                        </a>
                    </div>
                </div>

                <div data-ng-if="!agoraEnabled"
                     data-ng-show="order.url">
                    <div class="row">
                        <div class="col-md-9">
                            <p class="text-primary font-weight-bold"
                               data-i18n-static="license_order_step4_generated">
                            </p>
                            <span class="d-block"
                                  data-i18n-static="license_order_step4_clic_here">
                            </span>
                            <span data-i18n-static="license_order_step4_bc_information"></span>
                        </div>
                        <div class="col-md-3">
                            <button type="button"
                                    class="btn btn-default btn-block"
                                    data-ng-click="openBc()"
                                    data-i18n-static="license_order_step4_pay_button">
                            </button>
                        </div>
                    </div>
                </div>

            </div>

        </div>
    </div>
    <!-- /.row -->
</div>

<div id="currentAction" class="modal fade currentAction" tabindex="-1" data-role="dialog" data-aria-hidden="true">
    <div class="modal-dialog">
        <div id="modal-container" class="modal-content" data-ng-include="stepPath"></div>
        <div id="modal-help" class="help4wizards" style="width: 230px;"></div>
    </div>
</div>
