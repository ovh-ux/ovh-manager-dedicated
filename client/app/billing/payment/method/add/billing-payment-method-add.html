<div class="billing-payment-method-add">

    <div data-ovh-alert="billing_payment_method_add_alert"></div>

    <oui-message class="mb-3"
                 data-ng-if="$ctrl.addAlertMessage.message"
                 data-type="{{ $ctrl.addAlertMessage.type }}">
        <span data-ng-bind-html="$ctrl.addAlertMessage.message"></span>
    </oui-message>

    <oui-back-button data-href="{{ $ctrl.$state.href($ctrl.$stateParams.from || '^') }}"
                     data-aria-label="{{ :: 'billing_payment_method_add_back_btn_title' | translate }}">
        <span data-translate="billing_payment_method_add_title"></span>
    </oui-back-button>

    <div class="text-center"
         data-ng-if="$ctrl.loading.init || $ctrl.loading.add">
        <oui-spinner></oui-spinner>
    </div>

    <div class="row"
         data-ng-if="!$ctrl.loading.init"
         data-ng-hide="$ctrl.loading.add">
        <div class="col-md-8">
            <oui-stepper data-on-finish="$ctrl.onPaymentMethodAddStepperFinish()">
                <!-- Choose payment method type step -->
                <oui-step-form data-header="{{ :: 'billing_payment_method_add_choose_type' | translate }}"
                               data-submit-text="{{ $ctrl.addSteps.paymentMethodType.isLastStep() ? 'common_add' : 'common_next' | translate }}"
                               data-disabled="$ctrl.loading.paymentMethodTypes">

                    <ovh-payment-method-available-types
                        data-selected-payment-type="$ctrl.model.selectedPaymentMethodType"
                        data-on-selected-payment-type-change="$ctrl.model.setAsDefault = false"
                        data-on-loaded="$ctrl.loading.paymentMethodTypes = false"
                        data-on-load-error="$ctrl.onAvailablePaymentMethodsLoadError.bind($ctrl)">
                    </ovh-payment-method-available-types>

                    <div data-ng-if="$ctrl.model.selectedPaymentMethodType">
                        <div data-ng-switch="$ctrl.model.selectedPaymentMethodType.paymentType.value">
                            <p data-ng-switch-when="CREDIT_CARD"
                               data-ng-if="$ctrl.currentUser.ovhSubsidiary === 'FR'"
                               data-translate="billing_payment_method_add_credit_card_selected_explain"
                               data-translate-values="{ amount: $ctrl.bankAccountFootprintAmount }">
                            </p>
                            <p data-ng-switch-when="CREDIT_CARD"
                               data-ng-if="$ctrl.coreConfig.getRegion() !== 'US' && $ctrl.currentUser.ovhSubsidiary !== 'FR'"
                               data-translate="billing_payment_method_add_credit_card_selected_explain_generic">
                            </p>
                            <p data-ng-switch-when="CREDIT_CARD"
                               data-translate="billing_payment_method_add_credit_card_selected">
                            </p>
                            <p data-ng-switch-when="CREDIT_CARD"
                               data-ng-if="$ctrl.model.selectedPaymentMethodType.original && $ctrl.coreConfig.getRegion() !== 'US'"
                               data-translate="billing_payment_method_add_selected_common_redirect">
                            </p>
                            <p data-ng-switch-when="BANK_ACCOUNT">
                                <span class="d-block"
                                      data-translate="billing_payment_method_add_selected_common_redirect"
                                      data-ng-if="!$ctrl.model.selectedPaymentMethodType.original">
                                </span>
                                <span class="d-block"
                                      data-translate="billing_payment_method_add_bank_account_selected"
                                      data-ng-if="$ctrl.model.selectedPaymentMethodType.original">
                                </span>
                            </p>
                            <p data-ng-switch-when="PAYPAL"
                               data-translate="billing_payment_method_add_selected_paypal_redirect">
                            </p>
                        </div>
                    </div>

                    <!-- Default payment method -->
                    <p data-ng-if="$ctrl.billingPaymentMethodSection.sharedPaymentMethods.length === 0"
                       data-translate="billing_payment_method_add_default_payment">
                    </p>
                    <oui-checkbox data-model="$ctrl.model.setAsDefault"
                                  data-ng-if="$ctrl.billingPaymentMethodSection.sharedPaymentMethods.length > 0">
                        <span data-translate="billing_payment_method_add_set_as_default_payment"></span>
                    </oui-checkbox> <!-- End of Default payment method -->
                </oui-step-form> <!-- End of Choose payment method type step -->

                <!-- Legacy bank account step -->
                <oui-step-form data-header="{{ :: 'billing_payment_method_add_bank_account_informations' | translate }}"
                               data-submit-text="{{ :: 'common_next' | translate }}"
                               data-position="{{ $ctrl.addSteps.legacyBankAccount.position }}"
                               data-ng-if="$ctrl.addSteps.legacyBankAccount.isVisible()">
                    <div class="row">
                        <div class="col-md-6">
                            <div data-ui-view="legacyBankAccount"></div>
                        </div>
                    </div>
                </oui-step-form> <!-- End of Legacy bank account step -->

                <!-- Legacy bank account owner step -->
                <oui-step-form data-header="{{ :: 'billing_payment_method_add_bank_account_address' | translate }}"
                               data-submit-text="{{ :: 'common_add' | translate }}"
                               data-position="{{ $ctrl.addSteps.legacyBankAccountOwner.position }}"
                               data-ng-if="$ctrl.addSteps.legacyBankAccountOwner.isVisible()">
                    <div class="row">
                        <div class="col-md-6">
                            <div data-ui-view="legacyBankAccountOwner"></div>
                        </div>
                    </div>

                    <p data-translate="billing_payment_method_add_selected_original_credit_card_redirect"></p>
                </oui-step-form> <!-- End of Legacy bank account owner step -->

                <!-- Payment method -->
                <oui-step-form data-header="{{ :: 'billing_payment_method_add_payment_method' | translate }}"
                               data-submit-text="{{ $ctrl.addSteps.paymentMethod.isLastStep() ? 'common_add' : 'common_next' | translate }}"
                               data-position="{{ $ctrl.addSteps.paymentMethod.position }}"
                               data-on-focus="$ctrl.addSteps.paymentMethod.onFocus()"
                               data-ng-if="$ctrl.addSteps.paymentMethod.isVisible()">

                    <ovh-payment-method-register
                        data-payment-method-type="$ctrl.model.selectedPaymentMethodType"
                        data-on-init="$ctrl.onPaymentMethodRegisterInitialized.bind($ctrl)">
                    </ovh-payment-method-register>

                </oui-step-form> <!-- End of Payment method -->
            </oui-stepper>
        </div>
    </div>


</div>
